<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
	

<head>
<!-- Required meta tags -->
<meta charset="utf-8">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- Google Material icon -->
<link
	href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
	rel="stylesheet">

<title>Hello, world!</title>

    <!-- 요기에 구글 머티리얼 아이콘 -->
    <link
            href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
            rel="stylesheet">

    <!-- jquery 사용하기 위해 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<style>
a {
  text-decoration-line: none;
   color : black;
  }
.navbar {
	position: fixed;
	width: 100%;
	background-color: white;
	border-bottom: solid 1px rgb(202, 202, 202);
}

.container-fluid {
	justify-content: space-between;
	min-width: 1000px;
	width: 1000px
}

.navbar-search {
	width: 300px;
	font-size: 14px;
}

.body {
	padding-top: 100px;
	display: flex;
	flex-direction: row;
	justify-content: center;
	font-size: 14px;
	background-color: #FAFAFA
}

.left-body {
	width: 630px;
	min-width: 630px;
	height: 1000px;
	margin-right: 350px;
}

.right-body {
	width: 320px;
	min-width: 320px;
	height: 1000px;
	position: fixed;
	margin-left: 650px;
}

.feed-box {
	border: solid 1px rgb(202, 202, 202);
	background-color: white;
	margin-bottom: 25px;
}

.profile {
	display: flex;
	flex-direction: row;
	align-items: center;
}

.profile-id {
	font-weight: bold;
}

.profile-name {
	font-size: 12px;
}

.profile-img-box {
	width: 40px;
	height: 40px;
	border-radius: 70%;
	overflow: hidden;
	margin: 10px;
	margin-right: 15px;
}

.profile-img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.profile-text {
	flex-direction: column;
	text-align: left;
}

#feed-img {
	width: 100%;
}

.icon {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	margin: 10px;
}

.like {
	text-align: left;
	margin: 10px;
	font-size: 13px;
}

.feed-text {
	text-align: left;
	margin: 10px;
}

.comment {
	text-align: left;
	margin: 10px;
}

#input-comment {
	box-shadow: none;
	border: none;
	border-top: solid 1px rgb(202, 202, 202);
}

.recommend-msg {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	margin-left: 10px;
	font-weight: bold;
	margin-top: 10px;
	margin-bottom: 7px;
}

#recommend-text {
	color: grey;
}

#recommend-plus {
	text-decoration: none;
	color: black;
}

#follow {
	text-decoration: none;
	font-weight: bold;
	color: rgb(70, 156, 255);
}

.recommend-lst {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
}

.information {
	color: rgb(197, 197, 197);
	font-size: 11px;
	margin-left: 10px;
	margin-top: 25px;
}

 .modal_overlay {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(1.5px);
        -webkit-backdrop-filter: blur(1.5px);
    }

    .modal_window {
        background: white;
        backdrop-filter: blur(13.5px);
        -webkit-backdrop-filter: blur(13.5px);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        width: 900px;
        height: 600px;
        position: relative;
        padding: 13px;
    }
     .modal_title{
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        font-weight: bold;
        font-size: 20px;
    }

    .modal_title_side{
        flex: 0 0 40px;
        text-align: center;
    }
    .modal_image_upload{
        outline: 2px dashed black ;
        outline-offset:-10px;
        text-align: center;
        transition: all .15s ease-in-out;
        width:780px;
        height: 548px;
    }
    .main_body {
        display: flex;
        justify-content: center;
        padding-top: 50px;
        background-color: #FAFAFA;
    }
   
    .feed_box {
        background-color: white;
        width: 580px;
        margin: 10px;
        min-height: auto;
        padding-bottom: 10px;
    }

    .feed_img {
        width: 100%;
        object-fit: contain;
    }

    .feed_content {
        padding: 0px 10px;
    }

    .feed_like {
        padding: 0px 10px;
    }

    .feed_reply {
        padding: 0px 10px;
        display: flex;
        flex-direction: column;
    }


    .feed_txt {
        font-size: 14px;
    }


    .feed_icon {
        padding: 5px 5px 0px 5px;
        display: flex;
        justify-content: space-between;
    }

    span {
        padding-right: 5px;
    }

    .feed_name {
        padding: 10px;
        display: flex;
        align-items: center;
    }

    .feed_name_txt {
        font-size: 14px;
        padding: 0px 10px;
        font-weight: bold;
    }

    .profile_box {
        width: 40px;
        height: 40px;
        border-radius: 70%;
        overflow: hidden;
    }

    .profile_img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .name_content {
        display: flex;
        flex-direction: column;
    }

    .name_content_txt {
        font-size: 12px;
        padding: 0px 10px;
        font-weight: bold;
        color: lightgray;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 190px;
    }

    .big_profile_box {
        width: 60px;
        height: 60px;
        border-radius: 70%;
        overflow: hidden;
    }

    .link_txt {
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        text-decoration: none;
    }

    .recommend_box {
        display: flex;
        justify-content: space-between;
        padding: 5px;
        font-size: 14px;
        font-weight: bold;
        align-items: center;
    }

    .comment_box {
        margin: 40px 0 0 5px;
        font-size: 12px;
        font-weight: bold;
        color: lightgray;
        display: flex;
        flex-direction: column;
    }

    @media screen and (max-width: 1280px) {
        .right_body {
            display: none;
        }
    }


    .modal {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(1.5px);
        -webkit-backdrop-filter: blur(1.5px);
    }

    .modal_window {
        background: white;
        backdrop-filter: blur(13.5px);
        -webkit-backdrop-filter: blur(13.5px);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        width: 900px;
        height: 600px;
        position: relative;
    }

    .modal_title{
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        font-weight: bold;
        font-size: 20px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.18);
    }

    .modal_title_side{
        margin: 5px;
        flex: 0 0 40px;
        text-align: center;
    }

    .modal_image_upload{
        outline: 2px dashed black ;
        outline-offset:-10px;
        transition: all .15s ease-in-out;
        width: 798px;
        height: 548px;
        text-align: center;
        line-height: 548px;
    }

    .modal_image_upload_content{
        outline: 2px dashed black ;
        outline-offset:-10px;
        text-align: center;
        transition: all .15s ease-in-out;
        width:500px;
        height: 548px;
    }

    .modal_image_content{
        display: flex;
        flex-direction: row;
    }

    .modal_content_write{
        display: flex;
        flex-direction: column;
        border-left: 1px solid rgba(0, 0, 0, 0.18);;
    }

    .feed_content_textarea{
        resize: none;
        width: 294px;
        border: none;
    }
	.col-sm-5{
		width: 500px;
	}
</style>
</head>

<body>

	<!-- 헤더 영역 -->
	<nav class="navbar">
		<div class="container-fluid">
			<a class="navbar-brand" href="#">
			<img src="https://www.instagram.com/static/images/web/mobile_nav_type_logo.png/735145cfe0a4.png"></a>
			<input class="navbar-search form-control me-2" type="search"
				placeholder="검색" aria-label="Search">
			<div class="navbar_icons">
				<a class="material-icons" href="/main">home</a>  <!-- 홈링크 걸기 -->
				<a class="material-icons-outlined">send</a> <!-- 채팅기능 걸기 -->
				<span class="material-icons-outlined" id="add_feed">add_box</span>  <!-- 등록 -->
				<!--  <span class="material-icons-outlined">favorite_border</span>   좋아요 -->
			</div>
		</div>
	</nav>

	<!-- 바디 영역 -->
	<div class="body">
		<div class="left-body">
			<div class="feed-box" id="inst" style="padding: 20px">
					<input type="hidden" name="id" th:value="${session.name}" id="id">
			<div th:each="d : ${diarys}" >
			<input type="hidden" id="diaryCode" name="diaryCode">
				<div class="profile-id" th:text="${d.id}" style="margin: 10px">
					<div class="profile-id" ></div>
					<input type="hidden" name="diaryCode" id="diaryCode" value="1">
				</div>
				<div class="feed-img" > 
					<img id="feed-img"
						src="https://static-storychat.pstatic.net/2020/9/1/47/208797_hm2fj34m3df60.jpg">
				</div>

				<div class="icon">
				<!-- 인식이 안됨  
					<div>
						<span class="material-icons-outlined"></span> <span
							class="material-icons-outlined"></span> <span
							class="material-icons-outlined"></span>
					</div>
					<div>
						<span class="material-icons-outlined"></span>
					</div>
					-->
				</div>
				<div class="like" id="diaryStartDate" th:text="${d.diaryStartDate}" style="float: left;"></div>
				<div class="like" id="diaryEndDate" th:text="${d.diaryEndDate}" style="float: left;"></div>
				<br><br>
				<h5><b><div class="feed-text" id="diarytitlet" th:text="${d.diaryTitle}" style="float: none;" ></div></h5></b>
				<div class="feed-text" id="diaryContent" th:text="${d.diaryContent}" style="float: none;" >
				</div>

				<div class="comment">
					<div>
						<b>기덕</b> 장고 화이팅
					</div>
					<div>
						<b>재명</b> 알고리즘 화이팅
					</div>
					<div>
						<b>이성</b> 파이썬 화이팅
					</div>
				</div>
				<div class="input-comment">
					<input id="input-comment" type="text" class="form-control"
						placeholder="댓글 달기...">
				</div>
				<a class="btn btn-primary">수정</a>&nbsp;&nbsp;&nbsp;
				<input type="hidden" name="noticeCode" th:value="${d.diaryCode}" />
			<button type="submit" class="btn btn-danger" id="Delbtn">삭제</button>
			</div>
			</div>
		</div>
			<br><br>

	
		
	</div>
	<!-- Optional JavaScript; choose one of the two! -->

	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
		crossorigin="anonymous">
	</script>

<!-- 공유하기 모달 시작  -->
   <div id="modal_add_feed" class="modal modal_overlay">
    <div class="modal_window">
        <div class="modal_title">
            <div class="modal_title_side"></div>
            <div> 새 게시물 </div>
            <div class="modal_title_side">
                <span id="close_modal" class="close_modal material-icons-outlined" style="font-size: 30px">
                    close
                </span>
            </div>
        </div>
        <div class="modal_image_upload" id="imgGroCode" name="imgGroCode">
            <span style="text-align: center"> 사진을 여기에 끌어다 놓으세요. </span>

        </div>
    </div>
</div>
<div id="modal_add_feed_content" class="modal modal_overlay_content">
    <div class="modal_window">
        <div class="modal_title">
            <div class="modal_title_side"></div>
            <div style="margin: 5px"> 새 게시물 </div>
            <div class="modal_title_side">
                 <span id="close_modal" class="close_modal material-icons-outlined" style="font-size: 30px">
                    close
                </span>
            </div>
        </div>
        <div class="modal_image_content">
            <div id="input_image" class="modal_image_upload_content">

            </div>
            <div class="modal_content_write">
                <div class="feed_name">
                    <span id="input_id" class="feed_name_txt"></span>
                </div>
                <div>
                 <input type="text" id="diaryTitle" name="diaryTitle" class="feed_content_textarea form-control col-sm-5 diaryTitle">
                </div>
                <div>
                여행 기간 : <input type="date" class="diaryStartDate" name="diaryStartDate">
                </div>
                <div>
                <input type="date"  class="diaryEndDate" name="diaryEndDate">
                </div>
                <div style="height: 440px">
                    <textarea id="input_content" class="feed_content_textarea form-control col-sm-5" rows="10"  placeholder="설명을 입력하세요..." name="diaryContent"></textarea>
                </div>
                <div style="width: 100%; text-align: center">
                    <button id="button_write_feed" type="button" class="btn btn-primary" style="width: 268px">공유하기</button>
                    </div>
            </div>
        </div>

    </div>
</div>
<!-- 공유하기 모달 종료  -->

<script>

$(document).ready(function(){
	getDiaryList();
})
const modal = document.getElementById("modal_add_feed");
const id = $("#id").val();
const btn =$('.btn-danger');

function getDiaryList(){
console.log(id)	
}


//모달 열기
const buttonAddFeed = document.getElementById("add_feed");
buttonAddFeed.addEventListener("click", e => {
    modal.style.display = "flex";
    document.body.style.overflowY = "hidden"; // 스크롤 없애기
});


// 모달 닫기 코드
const buttonCloseModal = document.getElementById("close_modal");
buttonCloseModal.addEventListener("click", e => {
    modal.style.display = "none";
    document.body.style.overflowY = "visible";
});


//마우스를 놨을 때, 즉 drop 했을 때 실행되는 함수
$('.modal_image_upload')
    .on("dragover", dragOver)
    .on("dragleave", dragOver)
    .on("drop", uploadFiles);

function dragOver(e){
	 console.log(e);
    e.stopPropagation();
    e.preventDefault();
    
    if (e.type == "dragover") {
        $(e.target).css({
            "background-color": "black",
            "outline-offset": "-20px"
        });
    } else {
        $(e.target).css({
            "background-color": "white",
            "outline-offset": "-10px"
        });
    }
}

//파일 올릴때 
function uploadFiles(e){
    e.dataTransfer = e.originalEvent.dataTransfer;
    e.stopPropagation();
    e.preventDefault();
    console.log(e.dataTransfer)
    console.log(e.originalEvent.dataTransfer)


    files = e.dataTransfer.files;
    if (files.length > 1) {
        alert('하나만 올려주세요.');
        return;
    }

    if (files[0].type.match(/image.*/)) {
        $('#modal_add_feed_content').css({
            display : 'flex'
        });
        $('.modal_image_upload_content').css({
            "background-image": "url(" + window.URL.createObjectURL(files[0]) + ")",
            "outline": "none",
            "background-size": "contain",
            "background-repeat" : "no-repeat",
            "background-position" : "center"
        });
        $('#modal_add_feed').css({
            display: 'none'
        })
    }else{
        alert('이미지가 아닙니다.');
        return;
    }
};


$('#button_write_feed').on('click', ()=>{
    const  imgGroCode= $('#input_image').css("background-image").replace(/^url\(['"](.+)['"]\)/, '$1');
    const content = $('#input_content').val();
    const diaryTitle = $('.diaryTitle').val();
    const diaryContent = $('#input_content').val(); 
    const diaryStartDate = $(".diaryStartDate").val();
    const diaryEndDate = $(".diaryEndDate").val();
    const id = $("#id").val();


    let fd = new FormData();
	
    
    fd.append('imgGroCode', imgGroCode);
    fd.append('diaryTitle', diaryTitle);
    fd.append('diaryContent', diaryContent);
    fd.append('diaryStartDate', diaryStartDate)
    fd.append('diaryEndDate', diaryEndDate)
    fd.append('id', id);

 // FormData의 key 확인
    for (let key of fd.keys()) {
      console.log(key+"key값+++++++++++++++++++++");
    }

    // FormData의 value 확인
    for (let value of fd.values()) {
      console.log(value+"밸류=======================");
    }
 
    writeFeed(fd);
});

 function writeFeed(fd) {  //등록하는곳 
    $.ajax({
        url: "/diaryInsert",
        data: fd,
        method: "POST",
        processData: false,
        contentType: false,
        success: function (data) {
            console.log("성공");
        },
        error: function (request, status, error) {
            console.log("에러");
            getDiaryList();
        }
    })
};

//삭제
function diaryDel(){
	 $.ajax({
	        url: "/diaryDelete/"+diaryCode+"/"+ id,
	        type: "POST",
	        data: fd,
	        success: function (data) {
	            console.log("성공");
	        },
	        error: function (request, status, error) {
	            console.log("에러");
	            getDiaryList();
	        }
	    })
	    console.log(fd);
	};


</script>
</html>