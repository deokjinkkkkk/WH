<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{index}">

<body>
	<div layout:fragment="content" class="content">
		<!-- start page title section -->
		<section class="page-title-section bg-img cover-background"
			th:style="|background: url('img/banner/bg3.jpg')|">
			<div class="container">
				<h1 class="text-white font-weight-600">Hotel</h1>
				<ul>
					<li><a href="/main">Home</a></li>
					<li><span class="active">Hotel</span></li>
				</ul>
			</div>
		</section>
		<!-- end page title section -->
		
		<!-- start blog detail section -->
        <section class="blogs">
            <div class="container">
                <div class="row">

                    <!-- 여기에넣기 -->
                    <div
										class="col-lg-8 col-md-12 sm-margin-40px-bottom xs-margin-35px-bottom blogs">
										
										<div class="posts">
											<!--  start post-->
											<div class="post">
												<div class="content">
													<p style="font-size: 30px;">나의 예약내역</p>
														<div th:each="r : ${res}">
															<ul class="tour-inner">
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">예약번호</h6>
																		</div>
																		<div>
																			<p th:text="${r.resId}" id="resId" data-no="${r.resId}"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"></p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">호텔명</h6>
																		</div>
																		<div>
																			<p th:text="${r.hotelName}"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"></p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">방 등급</h6>
																		</div>
																		<div>
																			<p th:text="${r.roomGrade}"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"></p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">숙박일자</h6>
																		</div>
																		<div>
																			<p
																				th:text="|${#dates.format(r.checkIn, 'yyyy년 MM월 dd일')} ~
																			${#dates.format(r.checkOut, 'yyyy년 MM월 dd일')}|"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">오후
																				3시</p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">인원</h6>
																		</div>
																		<div>
																			<p
																				th:text="|성인 ${r.humanCount}명, 유아 ${r.childCount}명|"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">디럭스</p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">예약자명</h6>
																		</div>
																		<div>
																			<p th:text="${r.resName}" id="resName"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"></p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">예약자
																				전화번호</h6>
																		</div>
																		<div>
																			<p th:text="${r.resTel}" id="resTel"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">서울</p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">예약자 이메일</h6>
																		</div>
																		<div>
																			<p th:text="${r.resEmail}" id="resEmail"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">디럭스</p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">요청사항</h6>
																		</div>
																		<div>
																			<p th:text="${r.resRequest}" id="resRequest"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">디럭스</p>
																		</div>
																	</div>
																</li>
																<li>
																	<div class="row align-items-center">
																		<div class="col-md-6">
																			<h6 class="font-size17 no-margin-bottom">예약상태</h6>
																		</div>
																		<div>
																			<p th:text="${r.resState}" id="resEmail"
																				class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">디럭스</p>
																		</div>
																	</div>
																</li>
															</ul>
															<button class="butn updatebtn" type="button">예약자
																정보수정</button>
															<button class="butn cancelbtn" type="button">예약
																취소</button>
															<!-- 버튼에 이벤트 걸기. 참고 : reservation.html -->
												
														</div>
												</div>
												
												
												
												<script th:inline="javascript">
													// 예약 취소
													$(".cancelbtn").on('click', function(e){
														var result = confirm("예약 취소를 요청하시겠습니까?");
															if(result == true){
	// 														console.log($.trim($(e.target).parent().find('li:nth-child(1)').children().children('div:eq(1)').text()))
// 															console.log($.trim($(e.target).parent().find('li:nth-child(6)').children().children('div:eq(1)').text()))
															let resId = $.trim($(e.target).parent().find('li:nth-child(1)').children().children('div:eq(1)').text());
															let resName = $.trim($(e.target).parent().find('li:nth-child(6)').children().children('div:eq(1)').text());
															let resTel = $.trim($(e.target).parent().find('li:nth-child(7)').children().children('div:eq(1)').text());
															let resEmail = $.trim($(e.target).parent().find('li:nth-child(8)').children().children('div:eq(1)').text());
															let resRequest = $.trim($(e.target).parent().find('li:nth-child(9)').children().children('div:eq(1)').text());
															
															$.ajax({
																url : "/cancel",
																type : "POST",
																data : JSON.stringify(
																	{
																		"resId": resId,
																		"resName": resName,
																		"resTel": resTel,
																		"resEmail": resEmail,
																		"resRequest": resRequest
																	}
																),
																contentType:'application/json',
																success : function(result){
																	if(result == "y") {
																		alert("취소신청이 완료되었습니다. 관리자 확인 후 취소승인됩니다.");
																	}else{
																		alert("디비입력실패");
																		return false;
																	}
																},
																error : function(a,b,c){}
															});
															}else{
																return false;
															}
													})
													
													// 예약자 정보 수정
													$(".updatebtn").on('click', function(e){
														var result = confirm("예약자 정보를 수정하시겠습니까?");
														
														if(result == true){
															let resId1 = $.trim($(e.target).parent().find('li:nth-child(1)').children().children('div:eq(1)').text()); // 예약번호 찾기
													
															// 수정 정보를 받을 input 태그 만들기
															let newInput6 = $("<input>").attr({
															    id: "updateName",
															    required: "required",
															    type: "text"
															});
															let newInput7 = $("<input>").attr({
															    id: "updateTel",
															    required: "required",
															    type: "tel"
															});
															let newInput8 = $("<input>").attr({
															    id: "updateEmail",
															    required: "required",
															    type: "email"
															});
															let newInput9 = $("<textarea>").attr({
															    id: "updateRequest",
															    required: "required",
// 															    type: "text"
															});
															
// 															let newInput7 = $("<input>").attr("id","updateTel");
// 															let newInput8 = $("<input>").attr("id","updateEmail");
// 															let newInput9 = $("<input>").attr("id","updateRequest");
															
															// 기존 정보 변수에 넣어 두기
															let resName = $.trim($(e.target).parent().find('li:nth-child(6)').children().children('div:eq(1)').text());
															let resTel = $.trim($(e.target).parent().find('li:nth-child(7)').children().children('div:eq(1)').text());
															let resEmail = $.trim($(e.target).parent().find('li:nth-child(8)').children().children('div:eq(1)').text());
															let resRequest = $.trim($(e.target).parent().find('li:nth-child(9)').children().children('div:eq(1)').text());
													
															// 기존 정보가 있던 p태그를 숨기고 만들어둔 input태그에 기존 정보를 담음
															$(e.target).parent().find('li:nth-child(6)').children().children('div:eq(1)').children().hide();
				                                            $(e.target).parent().find('li:nth-child(6)').children().children().next().append(newInput6.val(resName));
				                                             
				                                            $(e.target).parent().find('li:nth-child(7)').children().children('div:eq(1)').children().hide();
				                                            $(e.target).parent().find('li:nth-child(7)').children().children().next().append(newInput7.val(resTel));
				                                             
				                                            $(e.target).parent().find('li:nth-child(8)').children().children('div:eq(1)').children().hide();
				                                            $(e.target).parent().find('li:nth-child(8)').children().children().next().append(newInput8.val(resEmail));
				                                             
				                                            $(e.target).parent().find('li:nth-child(9)').children().children('div:eq(1)').children().hide();
				                                            $(e.target).parent().find('li:nth-child(9)').children().children().next().append(newInput9.val(resRequest));
															
															//기존 수정, 삭제 버튼 안 보이게
															$(e.target).hide();
															$(e.target).next().hide();
															
															// 수정 확인 버튼 만들기
															let newbtn = $("<button>").html("확인").attr({"id":"complete","class":"butn"});
															$(e.target).parent().find('li:nth-child(9)').append(newbtn);
														}
													});
													
													//만들어진 수정 확인 버튼에 이벤트 걸기
													$(document).on("click", "#complete", function(e) {
														/*
														예약번호(resId) 첫번째 예약건 걸로 찾아옴.. 시도해본것들
															1. this랑 e.target 모두 도큐먼트로 찍힘
															
// 														console.log($("r.resId").data("no"));
// 														let resId = $(this).parent().find('li:nth-child(1)').children().children('div:eq(1)').closest('p').text();
														
														*/
														let resId = $("#resId").text(); 
														let resName = $("#updateName").val();
														let resTel = $("#updateTel").val();
														let resEmail = $("#updateEmail").val();
														let resRequest = $("#updateRequest").val();
														
														$.ajax({
															url : "/updateInfo",
															type : "POST",
															data : JSON.stringify(
																{
																	"resId": resId,
																	"resName": resName,
																	"resTel": resTel,
																	"resEmail": resEmail,
																	"resRequest": resRequest
																}
															),
															contentType:'application/json',
															success : function(result){
																if(result == "y") {
																	alert("예약정보가 수정되었습니다.");
																	
																	//만들었던 수정 확인 버튼 지우고 기존 버튼 보이게
																	$(e.target).remove();
																	$(".updatebtn").show();
																	$(".cancelbtn").show();
																	
																	//숨겨둔 p태그 보이게
																	$("#resName").text(resName).show();
																	$("#resTel").text(resTel).show();
																	$("#resEmail").text(resEmail).show();
																	$("#resRequest").text(resRequest).show();
																	
																	//만들었던 input태그 지움
																	$("#updateName").remove();
																	$("#updateTel").remove();
																	$("#updateEmail").remove();
																	$("#updateRequest").remove();
																	
																}else{
																	
																	alert("디비입력실패");
																	return false;
																}
															},
															error : function(a,b,c){}
														});
													});
													
												</script>
											</div>
										</div>
									</div>

                    <!--  start blog right-->
                    <div class="col-lg-4 col-md-12 padding-30px-left sm-padding-15px-left">
                        <div class="side-bar">
                        
                        		<!-- 검색창 -->
<!--                             <div class="widget search"> -->
<!--                                 <div class="input-group mb-3"> -->
<!--                                     <input type="text" class="form-control" placeholder="Type here..." aria-label="Recipient's username" aria-describedby="button-addon2"> -->
<!--                                     <div class="input-group-append"> -->
<!--                                         <button class="butn" type="button" id="button-addon2"><span class="ti-search"></span></button> -->
<!--                                     </div> -->
<!--                                 </div> -->
<!--                             </div> -->

                            <div class="widget">
                                <div class="widget-title margin-20px-bottom" style="margin-top: 40px;">
								    <p style="font-size: 20px;">예약 목록</p>
								</div>
                                <ul class="widget-list">
                                    <li>
                                        <a href="/myReservation">현재 예약내역 보기
                                        </a>

                                    </li>
                                    <li>
                                        <a href="/finReservation">지난 예약 보기
                                        </a>

                                    </li>
                                    <li>
                                        <a href="/cancelReservation">취소한 예약 보기
                                        </a>
                                    </li>
                                </ul>
                            </div>

<!--                             <div class="widget"> -->
<!--                                 <div class="widget-title"> -->
<!--                                     <h3>Recent Posts</h3> -->
<!--                                 </div> -->
<!--                                 <div class="media margin-20px-bottom align-items-center"> -->
<!--                                     <img src="img/blog/blog-8.jpg" class="mr-3 border-radius-4" alt="" /> -->
<!--                                     <div class="media-body"> -->
<!--                                         <h5 class="no-margin-top margin-5px-bottom font-size17"><a href="#" class="text-extra-dark-gray">I think that's a really good motto</a></h5> -->
<!--                                         <span class="font-size14">20 Jan, 2020</span> -->
<!--                                     </div> -->
<!--                                 </div> -->
<!--                                 <div class="media margin-20px-bottom align-items-center"> -->
<!--                                     <img src="img/blog/blog-9.jpg" class="mr-3 border-radius-4" alt="" /> -->
<!--                                     <div class="media-body"> -->
<!--                                         <h5 class="no-margin-top margin-5px-bottom font-size17"><a href="#" class="text-extra-dark-gray">get in the mood for your next epic trip</a></h5> -->
<!--                                         <span class="font-size14">12 Feb, 2020</span> -->
<!--                                     </div> -->
<!--                                 </div> -->
<!--                                 <div class="media align-items-center"> -->
<!--                                     <img src="img/blog/blog-12.jpg" class="mr-3 border-radius-4" alt="" /> -->
<!--                                     <div class="media-body"> -->
<!--                                         <h5 class="no-margin-top margin-5px-bottom font-size17"><a href="#" class="text-extra-dark-gray">Life is either adventure or nothing</a></h5> -->
<!--                                         <span class="font-size14">17 Feb, 2020</span> -->
<!--                                     </div> -->
<!--                                 </div> -->
<!--                             </div> -->

<!--                             <div class="widget"> -->
<!--                                 <div class="widget-title"> -->
<!--                                     <h3>Tags</h3> -->
<!--                                 </div> -->
<!--                                 <ul class="tags"> -->
<!--                                     <li><a href="#">Destination</a></li> -->
<!--                                     <li><a href="#">Travel</a></li> -->
<!--                                     <li><a href="#">Tip</a></li> -->
<!--                                     <li><a href="#">Discover</a></li> -->
<!--                                     <li><a href="#">Tour</a></li> -->
<!--                                     <li><a href="#">Explore</a></li> -->
<!--                                 </ul> -->
<!--                             </div> -->

                        </div>
                    </div>
                    <!--  end blog right-->

                </div>
            </div>
        </section>
        <!-- end blog detail section -->		
			</div>

</body>
</html>