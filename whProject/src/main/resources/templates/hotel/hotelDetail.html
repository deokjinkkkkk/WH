<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{index}">



<body>
   <!-- 각자 내용 -->
   <div layout:fragment="content" class="content">
      <!--좋아요 버튼 css-->
      <style>
a {
   text-decoration: none;
   color: inherit;
   cursor: pointer;
   
}

.right_area .icon {
   display: flex;
   align-items: center;
   justify-content: center;
   width: calc(100vw * ( 45/ 1920));
   height: calc(100vw * ( 45/ 1920));
   border-radius: 50%;
   border: solid 2px #eaeaea;
   background-color: #fff;
   
   
}

.icon.heart img {
   width: calc(100vw * ( 24/ 1920));
   height: calc(100vw * ( 24/ 1920));
}

.icon.heart.fas {
   color: red;
   position: absolute;
     left: 700px;
      top: 50px;
   
}

.heart {
   transform-origin: center;
   
   
}

.heart.active img {
   animation: animateHeart .3s linear forwards;
   
}

@keyframes animateHeart { 0%{
   transform: scale(.2);
   
}
40%
{
transform:scale(1.2);

}
100%
{
transform:scale(1);
}
}
#greatBtn{
position: absolute;
     left: 700px;
      top: 50px;
}


#tripBtn{
   position: absolute;
   left: 650px;
   top: 50px;
}
</style>
      <!--좋아요 버튼 css-종료-->



      <!-- start page title section -->
      <section class="page-title-section bg-img cover-background"
            th:style="|background: url('/img/banner/bg3.jpg')|">
         <div class="container">
            <h1 class="text-white font-weight-600">Hotel</h1>
            <ul>
               <li><a href="/main">Home</a></li>
               <li><span class="active">Hotel</span></li>
            </ul>
         </div>
      </section>
      <!-- end page title section -->
      <!-- start tour details section -->
      <section>
         <div class="container">
            <div class="row">
               <div
                     class="col-lg-8 col-md-12 sm-margin-40px-bottom xs-margin-35px-bottom blogs">
                  <div class="posts">
                     <!--  start post-->
                     <div class="post">
                        <div class="content">
                           <div class="blog-list-simple-text post-meta margin-20px-bottom">
                              <div class="post-title margin-20px-bottom">
                                 <p style="font-size:30px;" th:text="${h.hotelName}"></p><br>
                                 <!--좋아요 버튼 기능html-->
                                 <div class="right_area" id="greatBtn">
                                    <button type="button" class="icon heart">
                                       <img
                                             src="https://cdn-icons-png.flaticon.com/512/812/812327.png"
                                             id="greatImg"> 
                                    </button>
                                       <input type="hidden" id="id" name="id"
                                          th:value="${session.name}">
                                 </div>
                                 <!--좋아요 버튼 기능html 종료-->

                                 <!-- /////////////
                                 		북마크
                                 ///////////////// -->
                                 <!--즐찾 버튼 기능html-->
                                 <!-- 즐겨찾기를 누르지 않은 경우  -->
                                 <div class="book_area">
                                    <div class="bmark">
                                       <a href="#" class="emptyMark">
                                          <i class="fa-regular fa-bookmark" ></i>
                                       </a>
                                        <a href="/bookDel/{bookCode}" class="fullMark" style="display: none;">
                                     <i class="fa-solid fa-bookmark"></i>                                       
                                       </a> 
                                       <input type="hidden" id="id" name="id"
                                          th:value="${session.name}">
                                       <!-- 즐겨찾기를 누른 경우 -->
                                    </div>
                                 </div>
                                 <!-- 즐찾 버튼 끝 -->
                              </div>

                           </div>

                           <div
                                 class="row margin-40px-bottom border-bottom padding-30px-bottom">
                              <div class="col-md-6">
                                 <p class="margin-10px-bottom text-extra-dark-gray">
                                    <span class="ti-time text-theme-color margin-10px-right"></span>
                                    <a th:text="|별점 : ${h.star}점|"></a>

                                 </p>
                                 <p
                                       class="no-margin-bottom xs-margin-10px-bottom text-extra-dark-gray">
                                    <span class="ti-stamp text-theme-color margin-10px-right"></span>연령
                                    제한 없음
                                 </p>
                              </div>
                              <div class="col-md-6">
                                 <p class="margin-10px-bottom text-extra-dark-gray">
                                    <span class="ti-user text-theme-color margin-10px-right"></span>
                                    최대수용인원 : <a th:text="${h.roomLimit}"></a>명

                                 </p>
                                 <p class="no-margin-bottom text-extra-dark-gray">
                                    <span
                                          class="ti-location-pin text-theme-color margin-10px-right"></span>
                                    <a th:text="${h.hotelRegion}">서울</a>
                                 </p>

                              </div>
                           </div>
                           <div class="margin-40px-bottom">
                                                            <h5>Information</h5>
<!--                                                             <p th:text="${h.hotelInfo}" class="margin-30px-bottom">It is a long established -->
<!--                                                                fact that a reader will be distracted by the readable content -->
<!--                                                                of a page when looking at its layout. The point of using -->
<!--                                                                Lorem Ipsum is that it has a more-or-less normal distribution -->
<!--                                                                of letters, as opposed to using 'Content here, content here', -->
<!--                                                                making it look like readable English. Many desktop publishing -->
<!--                                                                packages and web page editors now use Lorem Ipsum as their.</p> -->
                              <div class="owl-carousel owl-theme tour">
                                 <div>
                                    <img th:src="${h.img1}" class="border-radius-4" alt="" />
                                 </div>
                                 <div>
                                    <img th:src="${h.img2}" class="border-radius-4" alt="" />
                                 </div>
                                 <div>
                                    <img th:src="${h.img3}" class="border-radius-4" alt="" />
                                 </div>
                              </div>
                           </div>
                           <div>
                              <ul class="tour-inner">
                                 <li>
                                    <div class="row align-items-center">
                                       <div class="col-md-6">
                                          <p class="no-margin-bottom" style="font-size:15px;">타입</p>
                                       </div>
                                       <div>
                                          <p th:text="${h.roomGrade}"
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">Kathmandu
                                             International Airport</p>
                                       </div>
                                    </div>
                                 </li>
                                 <li>
                                    <div class="row align-items-center">
                                       <div class="col-md-6">
                                          <p class="no-margin-bottom" style="font-size:15px;">입실시간</p>
                                       </div>
                                       <div>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">PM 3:00</p>
                                       </div>
                                    </div>
                                 </li>
                                 <li>
                                    <div class="row align-items-center">
                                       <div class="col-md-6">
                                          <p class="no-margin-bottom" style="font-size:15px;">퇴실시간</p>
                                       </div>
                                       <div>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">PM
                                             11:00</p>
                                       </div>
                                    </div>
                                 </li>
                                 <li>
                                    <div class="row align-items-center">
                                       <div class="col-md-6">
                                          <p class="no-margin-bottom" style="font-size:15px;">주소</p>
                                       </div>
                                       <div>
                                          <p th:text="${h.hotelAddr}"
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">서울</p>
                                       </div>
                                    </div>
                                 </li>
                                  <li>
                                    <div class="row align-items-center">
                                       <div class="col-md-6">
                                          <p class="no-margin-bottom" style="font-size:15px;">가격</p>
                                       </div>
                                       <div>
                                          <p th:text="|${#numbers.formatInteger(h.roomPrice, 3, 'COMMA')}원|"
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"></p>
                                       </div>
                                    </div>
                                 </li>
                                 <li>
                                    <div class="row">
                                       <div class="col-md-6">
                                          <p class="no-margin-bottom" style="font-size:15px;">주요시설</p>
                                       </div>
                                       <div>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>와이파이
                                          </p>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>레스토랑
                                          </p>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>피트니스
                                          </p>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>주차장
                                          </p>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>바/라운지
                                          </p>
                                       </div>
                                    </div>
                                 </li>
                                 <li>
                                    <div class="row">
                                       <div class="col-md-6">
                                          <p class="no-margin-bottom" style="font-size:15px;">객실시설</p>
                                       </div>
                                       <div>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>TV
                                          </p>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>에어컨
                                          </p>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>헤어드라이어
                                          </p>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>목욕 가운
                                          </p>
                                          <p
                                                class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray">
                                             <span class="ti-check text-info margin-5px-right"></span>냉장고
케이블
개인 욕실
안전 금고
TV
목욕 가운
비데
                                          </p>
                                       </div>
                                    </div>
                                 </li>
<!--                                  <li class="border-bottom"> -->
<!--                                     <div class="row"> -->
<!--                                        <div class="col-md-6"> -->
<!--                                           <p class="no-margin-bottom" style="font-size:15px;">Price -->
<!--                                              Includes</p> -->
<!--                                        </div> -->
<!--                                        <div> -->
<!--                                           <p -->
<!--                                                 class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"> -->
<!--                                              <span -->
<!--                                                    class="ti-close text-danger font-size12 margin-5px-right"></span>Flights -->
<!--                                           </p> -->
<!--                                           <p -->
<!--                                                 class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"> -->
<!--                                              <span -->
<!--                                                    class="ti-close text-danger font-size12 margin-5px-right"></span>Lunch -->
<!--                                           </p> -->
<!--                                           <p -->
<!--                                                 class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"> -->
<!--                                              <span -->
<!--                                                    class="ti-close text-danger font-size12 margin-5px-right"></span>Typical -->
<!--                                              Souvenir -->
<!--                                           </p> -->
<!--                                           <p -->
<!--                                                 class="no-margin-bottom xs-padding-15px-left text-extra-dark-gray"> -->
<!--                                              <span -->
<!--                                                    class="ti-close text-danger font-size12 margin-5px-right"></span>Sunscreen -->
<!--                                              and personal items -->
<!--                                           </p> -->
<!--                                        </div> -->
<!--                                     </div> -->
<!--                                  </li> -->
                              </ul>
                           </div>
                           <div class="margin-30px-top">
                              <div id="map" class="map-height"></div>
                           </div>
                        </div>
                     </div>
                     <!--post-->
                  </div>
               </div>
               <div
                     class="col-lg-4 col-md-12 padding-30px-left sm-padding-15px-left">
                  <div class="side-bar">
                     <div class="widget">
                        <div class="widget-title">
                           <p style="font-size:24px;">Reservation</p>
                        </div>

                        <form action="/reservation" method="post" id="searchFrm">
                           <div class="form-group">
                              <label class="margin-5px-bottom">checkin</label> <input
                                    type="date" th:value=${param.checkIn}
                                    class="form-control date no-margin-bottom padding-10px-tb"
                                    placeholder="체크인 날짜 선택" name="checkIn" id="checkIn">
                           </div>
                           <div class="form-group">
                              <label class="margin-5px-bottom">checkout</label> <input
                                    type="date" th:value=${param.checkOut}
                                    class="form-control date no-margin-bottom padding-10px-tb"
                                    placeholder="체크아웃 날짜 선택" name="checkOut" id="checkOut">
                           </div>
                           <div class="form-group margin-30px-bottom">
                              <label class="margin-5px-bottom">성인</label>
                              <select class="form-control padding-10px-tb" id="humanCount" name="humanCount">
							    <option value="1" th:selected="${#strings.equals(param.humanCount, '1')}">1명</option>
							    <option value="2" th:selected="${#strings.equals(param.humanCount, '2')}">2명</option>
							    <option value="3" th:selected="${#strings.equals(param.humanCount, '3')}">3명</option>
							    <option value="4" th:selected="${#strings.equals(param.humanCount, '4')}">4명</option>
							    <option value="5" th:selected="${#strings.equals(param.humanCount, '5')}">5명</option>
							</select>
                           </div>
                           <div class="form-group margin-30px-bottom">
                              <label class="margin-5px-bottom">유아(7세 이하)</label>
                              <select
                                    class="form-control padding-10px-tb" id="childCount"
                                    name="childCount">
									<option th:value="0" th:selected="${#strings.equals(param.childCount, '0')}">해당 없음</option>
									<option th:value="1" th:selected="${#strings.equals(param.childCount, '1')}">1명</option>
									<option th:value="2" th:selected="${#strings.equals(param.childCount, '2')}">2명</option>
									<option th:value="3" th:selected="${#strings.equals(param.childCount, '3')}">3명</option>
									<option th:value="4" th:selected="${#strings.equals(param.childCount, '4')}">4명</option>
									<option th:value="5" th:selected="${#strings.equals(param.childCount, '5')}">5명</option>
                              </select>
                           </div>
                           <button class="butn btn-block" type="button" onclick="reservCheck()">
                              <i class="fa fa-search"></i> 예약하기
                           </button>
                           <input type="hidden" id="hotelId" name="hotelId"
                                 th:value="${h.hotelId}">
                           <input type="hidden" id="price" th:name="price" value="">
                        </form>
                     </div>
                  </div>
               </div>
            </div>

            <script>
            // 예약 하기 전 예약 가능한 호텔인지 체크
            function reservCheck(){
            	
            	var newURL = window.location.href; // 현재 url
            	let hotelId = newURL.substr(29,3); // url에서 hotelId만 추출
            	
            	$.ajax({
            		type: "POST",
            		url: "/compareToDate",
            		data : JSON.stringify(
            			{
            				"checkIn" : $('#checkIn').val(),
            				"checkOut" : $('#checkOut').val(),
            				"hotelId" : hotelId
            			}		
            		),
            		contentType:"application/json",
            		success : function(result){
						if(result == true){
							let checkIn = $('#checkIn').val();
							let checkOut = $('#checkOut').val()
							
							//며칠 연박하는지 확인하는 함수(체크아웃날짜 - 체크인날짜)
				 			const getDateDiff = (d1,d2) => {
				 				  const date1 = new Date(d1); // 체크인일자
				 				  const date2 = new Date(d2); // 환불요청일자
				 				  
				 				  const diffDate = date1.getTime() - date2.getTime();
				 				  
				 				  return Math.abs(diffDate / (1000 * 60 * 60 * 24)); // 밀리세컨 * 초 * 분 * 시 = 일
				 				}

				 			let diffDate = getDateDiff(checkOut,checkIn); // 체크아웃날짜 - 체크인날짜 = 일수 차이를 숫자로 반환함
				 			console.log(diffDate);
				 			let totalPay = '[[${h.roomPrice}]]'*diffDate;
				 			console.log(totalPay)
				 			$("#price").val(totalPay);
				 			
							searchFrm.submit();
						}else{
							swal("이미 예약된 날짜입니다.","다른 날짜를 선택해주세요.","error")
							return false;
						}
            		},
            		error: function(error){
            			alert("ajax에러");
            		}
            	})
            	
            	
            }
            
            //좋아요 기능 시작

            //회원 좋아요 있는지 여부 확인 
            $(document).ready(function(){
               getGreat()
            })
            
            var id = $('#id').val();  //id값 들고오기 
            var greatNcode = window.location.pathname.split("/").pop(); //상세페이지 번호
            var greatFlag = ("LHT");  //호텔 구분
            var $likeBtn = $('.heart'); //하트버튼 id값
            
            
            var greatVO = {
                   id: id,
                   greatFlag: greatFlag,
                   greatNcode: greatNcode
               };
            
            //회원 좋아요 있는지 여부 확인 
            function getGreat(){
            $.ajax({
              url: "/greatCheck/"  + greatNcode +"/"+ id,
              data: greatVO
            }).then(function(result) { 
              if (result) { // greatCheck 메서드에서 반환된 값이 true/false이므로, result로 바로 사용 가능
                $likeBtn.addClass("active")
                .find("img").attr({
                  src: "https://cdn-icons-png.flaticon.com/512/803/803087.png", 
                })
              } else {
                $likeBtn.removeClass("active")
                .find("img").attr({
                  src: "https://cdn-icons-png.flaticon.com/512/812/812327.png",
                })
                
              }

            });
            }

            $(function() {
                 $likeBtn.click(function() {
                   if (!$likeBtn.hasClass('active')) {
                     $(this).find('img').attr({
                       'src': 'https://cdn-icons-png.flaticon.com/512/803/803087.png',
                       alt: '좋아요 꽉찬거'
                     });
                     great(); //좋아요 함수 호출 
                   } else {
                     $(this).find('i').removeClass('active');
                     $(this).find('img').attr({
                       'src': 'https://cdn-icons-png.flaticon.com/512/812/812327.png',
                       alt: '좋아요 안한거'
                     });
                     greatDown(); //좋아요 취소 호출 
                   }
                 });
               });


           
            //좋아요 클릭시 효과 
             function great() {
              $.ajax({
                url: "/greatUP/" + greatNcode,
                type: "POST",
                data: greatVO,
                success: function(result) {
                  swal("",result.message,"success")
                  getGreat(); //회원 확인 여부 호출
                },
                error: function() {
                  alert("좋아요를 누르는 중 오류가 발생했습니다.");
                }
              });
              console.log(greatVO);
            }

            //좋아요 취소시 효과 기능 
            function greatDown(){
                  $.ajax({
                    url: "/greatDown/" + greatFlag + "/" + greatNcode + "/" + id,
                    type: "POST",
                    data: greatVO,
                    success: function(result) {
                    	swal("",result.message,"success")
                      getGreat(); //회원 확인 여부 호출
                    },
                    error: function() {
                      alert("좋아요 취소 중 오류가 발생했습니다.");
                    }
                      });
                } 
            
            /* -----------------------
                  북마크 START
            -----------------------*/
         
            $(function() {
                 // 즐겨찾기 추가 여부 확인 함수
                 function checkBookmark() {
                   var id = $('#id').val();
                   var bookNcode = window.location.pathname.split("/").pop();
                   var bookFlag = ("HT") // 호텔/여행지 여부에 따라 bookFlag 값 지정
                   var bookCode =  $('#bookCode').val();

                   $.ajax({
                     type: 'POST',
                     url: '/bookmarkCheck/' + bookNcode + '/' + id,
                     data: {
                       'id': id,
                       'bookCode': bookCode
                     },
                     success: function(data) {
                         if (data === true) { // 즐겨찾기 추가된 경우
                             $('.emptyMark').hide(); // emptyMark 숨김
                             $('.fullMark').show(); // fullMark 보임
                         } else { // 즐겨찾기 추가되지 않은 경우
                             $('.fullMark').hide(); // fullMark 숨김
                             $('.emptyMark').show(); // emptyMark 보임
                         }
                     },
                     error: function() {
                         console.log('bookmarkCheck 오류');
                     }
                 });
                 }

                 // 페이지 로딩시 즐겨찾기 추가 여부 확인(새로고침에도 북마크 값 가지고옴)
                 checkBookmark();

                 
                 //즐겨찾기 추가 (emptyMark 클릭 시)
                 $('.emptyMark').on('click', function(e) {
                   e.preventDefault();
                   var id = $('#id').val();
                   var bookCode = $(this).data('bookcode');
                   var bookNcode = window.location.pathname.split("/").pop();
                   var fullMark = $(this).siblings('.fullMark');
                   var emptyMark = $(this);

                   $.ajax({
                     type: 'POST',
                     url: '/insertBookHotel/' + bookNcode,
                     data: {
                       'bookCode': bookCode,
                       'bookNcode': bookNcode
                     },
                     success: function(data) {
                       if (data.bookCode > 0) {
                         $('.emptyMark').hide();
                         $('.fullMark').show();
                         //alert('등록완료');
                       } else {
                         // 실패했을 때 
                       }
                     },
                     error: function() {
                       alert('등록실패!');
                     }
                   });
                 });
               });

            //즐겨찾기 취소(fullMark 클릭시)
          $('.fullMark').on('click', function(e) {
			  e.preventDefault();
			  var id = $('#id').val();
			  var bookCode = $(this).data('bookcode');
			  var bookNcode = window.location.pathname.split("/").pop();
			  var emptyMark = $(this).siblings('.emptyMark');
			  var fullMark = $(this);
			
			  $.ajax({
			    type: 'POST',
			    url: '/bookDel/' + bookNcode,
			    data: {
			      'bookCode': bookCode,
			      'bookNcode': bookNcode
			    },
			    success: function(data) {
			      if (data > 0) {
			    	  emptyMark.show();
		              fullMark.hide();
			        //alert('취소완료');
			      } else {
			        // 실패했을 때 
			      }

			    },
			    error: function() {
			      alert('취소실패!');
			    }
			  });
			});
          /* -----------------------
          북마크 끝!
    -----------------------*/

            </script>

         </div>
      </section>
      <!-- end tour details section -->
   </div>

</body>

</html>