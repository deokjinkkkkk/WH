<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.admin.wh.notice.mapper.CompanionMapper">

	<insert id="companionInsert"
		parameterType="co.admin.wh.notice.vo.CompanionVO">
		<selectKey keyProperty="compCode" resultType="int"
			order="BEFORE">
			SELECT NVL(MAX(COMP_CODE),0)+1 FROM COMPANION
		</selectKey>

		INSERT INTO COMPANION (COMP_CODE, ID,
		COMP_GROUP,COMP_TITLE,COMP_COUNT, comp_local, COMP_START_DATE, COMP_END_DATE,
		COMP_CONTENT,IMG_GRO_CODE)

		VALUES (#{compCode},#{id},#{compGroup},
		#{compTitle},
		#{compCount},#{compLocal},#{compStartDate},#{compEndDate},
		#{compContent},
		#{imgGroCode})
	</insert>

	<insert id="imgInsert"
		parameterType="co.admin.wh.common.vo.ImageVO">
		<selectKey keyProperty="imgCode" resultType="int"
			order="BEFORE">
			SELECT NVL(MAX(IMG_CODE),0)+1 FROM IMAGE
		</selectKey>
		INSERT INTO IMAGE (IMG_CODE,IMG_NAME, IMG_PATH, IMG_GRO_CODE)

		VALUES
		(#{imgCode},#{imgName},#{imgPath}, #{imgGroCode})
	</insert>


	<select id="getCompanionList"
		resultType="co.admin.wh.notice.vo.CompanionVO">
		SELECT * FROM( SELECT ROWNUM RN, A.* FROM(
		SELECT DISTINCT C.COMP_CODE,
		M.ID,
		C.AGE,
		C.COMP_GROUP,
		C.COMP_TITLE,
		C.COMP_COUNT,
		C.COMP_LOCAL,
		C.COMP_START_DATE,
		C.COMP_END_DATE,
		C.COMP_CONTENT,
		C.COU_CODE,
		C.IMG_GRO_CODE,
		M.TEL,
		M.NAME,
		M.GENDER,
		I.IMG_NAME,
		I.IMG_PATH
		FROM COMPANION C ,MEMBER M, IMAGE I
		WHERE C.ID= M.ID
		AND C.IMG_GRO_CODE = I.IMG_GRO_CODE
		ORDER BY COMP_CODE DESC
<![CDATA[
		) A  WHERE ROWNUM <=#{last} ) B WHERE RN >=#{first}
	]]>
	</select>


	<select id="detailSelect"
		resultType="co.admin.wh.notice.vo.CompanionVO">
		SELECT *
		FROM COMPANION
		WHERE COMP_CODE = #{compCode}
	</select>

	<!-- 전체건수조회 -->
	<select id="getCountTotal"
		parameterType="co.admin.wh.notice.vo.CompanionSearchVO"
		resultType="int">
		SELECT COUNT(*)
		FROM COMPANION
	</select>

	<update id="companionUpdate">
		UPDATE COMPANION
		<set>
			<if test="compTitle != NULL">COMP_TITLE = #{compTitle},</if>
			<if test="compCount != NULL">COMP_COUNT = #{compCount},</if>
			<if test="compGroup != NULL">COMP_GROUP = #{compGroup},</if>
			<if test="compStartDate != NULL">COMP_START_DATE = #{compStartDate},</if>
			<if test="compEndDate != NULL">COMP_END_DATE = #{compEndDate},</if>
			<if test="compContent != NULL">COMP_CONTENT = #{compContent}</if>
		</set>
		WHERE COMP_CODE=#{compCode}
	</update>

	<delete id="companionDelete">
		DELETE FROM COMPANION WHERE COMP_CODE = #{compCode}
	</delete>

	<select id="imgSelect" resultType="co.admin.wh.notice.vo.CompanionVO" >
		SELECT *
		FROM COMPANION c
		JOIN IMAGE i
		ON c.IMG_GRO_CODE = i.IMG_GRO_CODE
		WHERE c.COMP_CODE = #{compCode}
	</select>

</mapper>

