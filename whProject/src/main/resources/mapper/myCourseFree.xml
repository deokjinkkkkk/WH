<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.admin.wh.trip.mapper.MyCourseFreeMapper">
	
	<select id="myCourseTripList" resultType="co.admin.wh.trip.vo.MyCourseFreeVO">
		SELECT * FROM MY_COURSE_FREE
	</select>
	
	
	<!-- 나만의 코스 상세페이지 제목란에 제목 출력 -->
	<select id="oneSelect" resultType="co.admin.wh.trip.vo.MyCourseFreeVO">
			SELECT * FROM MY_COURSE_FREE
			WHERE MY_COURSE_CODE = ${myCourseCode}
	</select>
	
	<!-- 나만의 코스 상세페이지에 여행지 정보 저장하기 -->
	<insert id="myCourseInsert" parameterType="co.admin.wh.trip.vo.MyCourseFreeVO">
	<selectKey keyProperty="myCouFreeCode" resultType="int" order="BEFORE">
		SELECT NVL(MAX(MY_COU_FREE_CODE),0)+1 FROM MY_COURSE_FREE
	</selectKey>
	 INSERT INTO MY_COURSE_FREE
	 (trip_unique_number, my_course_code, 
	  cou_ord, my_cou_free_code, trip_name, img_gro_code, trip_addr)
	 VALUES (#{tripUniqueNumber}, #{myCourseCode},
	 (SELECT NVL(MAX(cou_ord), 0) + 1 FROM MY_COURSE_FREE WHERE MY_COURSE_CODE = #{myCourseCode}), 
	 #{myCouFreeCode}, #{tripName}, #{imgGroCode}, #{tripAddr})
	</insert>
	
	<!-- 나만의 코스 상세페이지에 담은 여행지 출력 -->
	<select id="myCourseSelect" resultType="co.admin.wh.trip.vo.MyCourseFreeVO">
		SELECT T.TRIP_NAME, T.IMG_GRO_CODE, T.TRIP_ADDR, T.TRIP_UNIQUE_NUMBER, T.TRIP_LAT, T.TRIP_LON, M.MY_COU_FREE_CODE, M.COU_ORD
		FROM TRIP T, MY_COURSE_FREE M
		WHERE M.TRIP_UNIQUE_NUMBER = T.TRIP_UNIQUE_NUMBER 
		AND M.MY_COURSE_CODE = #{myCourseCode}
		ORDER BY COU_ORD
	</select>
	
	<!-- 나만의 코스 상세페이지에 담은 각 여행지 삭제 -->
	<delete id="myCouDetailDel">
		DELETE FROM MY_COURSE_FREE
		WHERE MY_COU_FREE_CODE = #{myCouFreeCode}
	</delete>
	
	<!-- 여행지 삭제 시, 순서 번호 업데이트 -->
	<update id="couOrdUpdate">
	    UPDATE MY_COURSE_FREE
	    SET COU_ORD = COU_ORD - 1
	    WHERE COU_ORD > #{couOrd}
	</update>
	
	<!-- 나만의 코스 상세페이지에 담은 각 여행지 위아래로 이동 -->
	<update id="myCouUpdate">
		UPDATE MY_COURSE_FREE
		SET cou_ord = #{couOrd}
		WHERE MY_COU_FREE_CODE = #{myCouFreeCode}
	</update>
	

	<select id="aroundTagList" resultType="co.admin.wh.trip.vo.MyCourseVO">
		SELECT * FROM 
    (SELECT ROWNUM AS RNUM,
            my_course_code,
            theme,
            my_cou_date,
            my_cou_name,
            my_cou_content,
            my_cou_state,
            my_cou_id,
            tag_name,
            tag_code
    FROM (SELECT M.*, T.* FROM my_course M 
        LEFT OUTER JOIN tag_map R
            ON M.my_course_code = R.my_course_code
        LEFT OUTER JOIN tag T
            ON R.tag_code = T.tag_code 
    ORDER BY M.my_course_code DESC))
WHERE RNUM BETWEEN 1 AND 6;
	</select>



</mapper>